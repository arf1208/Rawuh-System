<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Rekap Absensi - SMK NU LAMONGAN</title>
    <link rel="stylesheet" href="css/style.css"> 
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body>
    <div id="wrapper">
        <div id="sidebar">
            <h3>Menu Admin</h3>
            <ul>
                <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="data_users.html"><i class="fas fa-users"></i> Manajemen Siswa</a></li>
                <li><a href="data_users.html"><i class="fas fa-users"></i> Manajemen Guru</a></li>
                <li><a href="rekap_absensi.html" class="active"><i class="fas fa-file-excel"></i> Rekap Absensi</a></li>
                <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </div>
        
        <div id="content">
            <h2><i class="fas fa-list-alt"></i> Rekap Data Absensi</h2>
            <hr>

            <div class="filter-section card p-3" style="margin-bottom: 20px;">
                <h3>Filter & Ekspor Data</h3>
                <form id="filter-form" style="display: flex; gap: 15px; align-items: flex-end;">
                    <div class="form-group">
                        <label for="filter-tanggal">Pilih Tanggal</label>
                        <input type="date" id="filter-tanggal" value="<?php echo date('Y-m-d'); ?>" required>
                    </div>
                    <div class="form-group">
                        <label for="filter-role">Role</label>
                        <select id="filter-role">
                            <option value="">Semua</option>
                            <option value="siswa">Siswa</option>
                            <option value="guru">Guru</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-info"><i class="fas fa-filter"></i> Terapkan Filter</button>
                    <button type="button" class="btn btn-success" onclick="triggerExport()"><i class="fas fa-download"></i> Export ke CSV/Excel</button>
                </form>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Nama</th>
                            <th>Role</th>
                            <th>Kelas/Jabatan</th>
                            <th>Jam Masuk</th>
                            <th>Jam Pulang</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="absensi-table-body">
                        <tr><td colspan="7">Silakan terapkan filter untuk melihat data.</td></tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
    <script src="js/admin.js"></script>
    <script>
        // Panggil fungsi loadAbsensiRealtime dengan tanggal hari ini saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filter-tanggal').value = today;
            loadAbsensiRealtime(today, document.getElementById('filter-role').value);
        });

        document.getElementById('filter-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const filterDate = document.getElementById('filter-tanggal').value;
            const filterRole = document.getElementById('filter-role').value;
            loadAbsensiRealtime(filterDate, filterRole);
        });
    </script>
</body>
</html>
